schema: '2.0'
stages:
  extract_sensors:
    cmd: python -m src.data.spatial_data
    deps:
    - path: DATA/raw/sensors/
      md5: 8e1dff9ea311d134bb026e9c3bb39c88.dir
      size: 7533252934
      nfiles: 640
    - path: DATA/raw/weather/
      md5: 6fc1ecee5d5eb450d1d2d77dcfd08dc1.dir
      size: 3774006
      nfiles: 1
    - path: requirements.txt
      md5: aa81df9430a7c47b9691bbebe5bdc453
      size: 339
    - path: src/data/opentopodata.py
      md5: 09038e1d814fff6bcb998429c2ca5d00
      size: 1497
    - path: src/data/osmdata.py
      md5: 1483ea3c9809b6e05ce66dd18cf60e25
      size: 2117
    - path: src/data/utils.py
      md5: 6354c16229ce22a3711241bff2336b93
      size: 4097
    params:
      params.yaml:
        data:
          coords:
            min_lat: 55.26
            max_lat: 56.47
            min_lon: 36.82
            max_lon: 38.4
          paths:
            checked_links: processing_lists/links_list.txt
            sensor_id: processing_lists/sensorID_list.txt
            sensor_data: DATA/raw/sensors/
            weather_data: DATA/raw/weather/
            weather_filename: weather_centr.csv
            sensors_file: DATA/processed/sensors.csv
            dataset_file: DATA/processed/dataset.csv
            osm_dump: DATA/raw/planet_37.15_55.486_4cd95583.osm.pbf
          urls:
            server: https://archive.sensor.community/
            weather1: https://rp5.ru/%D0%90%D1%80%D1%85%D0%B8%D0%B2_%D0%BF%D0%BE%D0%B3%D0%BE%D0%B4%D1%8B_%D0%B2_%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B5_(%D1%86%D0%B5%D0%BD%D1%82%D1%80,_%D0%91%D0%B0%D0%BB%D1%87%D1%83%D0%B3)
            weather2: https://rp5.ru/responses/reFileSynop.php
    outs:
    - path: DATA/processed/sensors.csv
      md5: 98669f2e26c1db6411a4479276d3bb6a
      size: 28220
  create_dataset:
    cmd: python -m src.data.sensors_data
    deps:
    - path: DATA/processed/sensors.csv
      md5: 98669f2e26c1db6411a4479276d3bb6a
      size: 28220
    - path: src/data/sensors_data.py
      md5: 5dc35172562453d51352c8b04cb426dc
      size: 2983
    - path: src/data/utils.py
      md5: 6354c16229ce22a3711241bff2336b93
      size: 4097
    params:
      params.yaml:
        data:
          coords:
            min_lat: 55.26
            max_lat: 56.47
            min_lon: 36.82
            max_lon: 38.4
          paths:
            checked_links: processing_lists/links_list.txt
            sensor_id: processing_lists/sensorID_list.txt
            sensor_data: DATA/raw/sensors/
            weather_data: DATA/raw/weather/
            weather_filename: weather_centr.csv
            sensors_file: DATA/processed/sensors.csv
            dataset_file: DATA/processed/dataset.csv
            osm_dump: DATA/raw/planet_37.15_55.486_4cd95583.osm.pbf
          urls:
            server: https://archive.sensor.community/
            weather1: https://rp5.ru/%D0%90%D1%80%D1%85%D0%B8%D0%B2_%D0%BF%D0%BE%D0%B3%D0%BE%D0%B4%D1%8B_%D0%B2_%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B5_(%D1%86%D0%B5%D0%BD%D1%82%D1%80,_%D0%91%D0%B0%D0%BB%D1%87%D1%83%D0%B3)
            weather2: https://rp5.ru/responses/reFileSynop.php
    outs:
    - path: DATA/processed/dataset.csv
      md5: 34faf888160635dc1b4dfc2a798c4095
      size: 581221045
  spat_cv:
    cmd: python -m experiments.spat_cv
    deps:
    - path: DATA/processed/dataset.csv
      md5: 34faf888160635dc1b4dfc2a798c4095
      size: 581221045
    - path: experiments/spat_cv.py
      md5: 675be3325d55b34e30b59b5fa867c1be
      size: 3139
    - path: src/gp/
      md5: abe56c5c5ab75c6b4f146da541b1f5e6.dir
      size: 45847
      nfiles: 25
    params:
      params.yaml:
        data:
          coords:
            min_lat: 55.26
            max_lat: 56.47
            min_lon: 36.82
            max_lon: 38.4
          paths:
            checked_links: processing_lists/links_list.txt
            sensor_id: processing_lists/sensorID_list.txt
            sensor_data: DATA/raw/sensors/
            weather_data: DATA/raw/weather/
            weather_filename: weather_centr.csv
            sensors_file: DATA/processed/sensors.csv
            dataset_file: DATA/processed/dataset.csv
            osm_dump: DATA/raw/planet_37.15_55.486_4cd95583.osm.pbf
          urls:
            server: https://archive.sensor.community/
            weather1: https://rp5.ru/%D0%90%D1%80%D1%85%D0%B8%D0%B2_%D0%BF%D0%BE%D0%B3%D0%BE%D0%B4%D1%8B_%D0%B2_%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B5_(%D1%86%D0%B5%D0%BD%D1%82%D1%80,_%D0%91%D0%B0%D0%BB%D1%87%D1%83%D0%B3)
            weather2: https://rp5.ru/responses/reFileSynop.php
        model:
          start_date: '2021-06-01'
          end_date: '2021-07-01'
          val_split: '2021-06-10'
          max_iter: 100
          num_induc: 200
          num_induc_upd: 20
          kernel: basic
          temp_cv:
            result_file: experiments/results/temp_cv.json
            plot_file: experiments/plots/temp_cv.json
            prediction: experiments/results/temp_cv.csv
          spat_cv:
            result_file: experiments/results/spat_cv.json
            plot_file: experiments/plots/spat_cv.json
            prediction: experiments/results/spat_cv.csv
    outs:
    - path: experiments/plots/spat_cv.json
      md5: e60237b94e1647277fc31738310c0962
      size: 867
    - path: experiments/results/spat_cv.json
      md5: dc4454e4fa72e13bddb0e6e20f80b198
      size: 64
  temp_cv:
    cmd: python -m experiments.temp_cv
    deps:
    - path: DATA/processed/dataset.csv
      md5: 34faf888160635dc1b4dfc2a798c4095
      size: 581221045
    - path: experiments/temp_cv.py
      md5: 1e5b8921b397fea9556981bf5049aeda
      size: 3907
    - path: src/gp/
      md5: fb7ceea8b556719e60018d65733477af.dir
      size: 46326
      nfiles: 26
    params:
      params.yaml:
        data:
          coords:
            min_lat: 55.26
            max_lat: 56.47
            min_lon: 36.82
            max_lon: 38.4
          paths:
            checked_links: processing_lists/links_list.txt
            sensor_id: processing_lists/sensorID_list.txt
            sensor_data: DATA/raw/sensors/
            weather_data: DATA/raw/weather/
            weather_filename: weather_centr.csv
            sensors_file: DATA/processed/sensors.csv
            dataset_file: DATA/processed/dataset.csv
            osm_dump: DATA/raw/planet_37.15_55.486_4cd95583.osm.pbf
          urls:
            server: https://archive.sensor.community/
            weather1: https://rp5.ru/%D0%90%D1%80%D1%85%D0%B8%D0%B2_%D0%BF%D0%BE%D0%B3%D0%BE%D0%B4%D1%8B_%D0%B2_%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B5_(%D1%86%D0%B5%D0%BD%D1%82%D1%80,_%D0%91%D0%B0%D0%BB%D1%87%D1%83%D0%B3)
            weather2: https://rp5.ru/responses/reFileSynop.php
        model:
          start_date: '2021-06-01'
          end_date: '2021-06-20'
          val_split: '2021-06-08'
          max_iter: 100
          num_induc: 300
          num_induc_upd: 30
          kernel: basic
          temp_cv:
            result_file: experiments/results/temp_cv.json
            plot_file: experiments/plots/temp_cv.json
            prediction: experiments/results/temp_cv.csv
          spat_cv:
            result_file: experiments/results/spat_cv.json
            plot_file: experiments/plots/spat_cv.json
            prediction: experiments/results/spat_cv.csv
    outs:
    - path: experiments/plots/temp_cv.json
      md5: 25a5d9fc5c6fdb65b275cc44321718e1
      size: 494
    - path: experiments/results/temp_cv.json
      md5: 382b002914ec668cfc12883c364738ec
      size: 64
